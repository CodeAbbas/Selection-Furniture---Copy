<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Selection Furniture</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="scripts/uikit.js"></script>
    <script src="scripts/uikit-icons.js"></script>
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/style.css">
    <style>
        /* Add these styles */
        .uk-slider-items img {
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .uk-slider-items .uk-active img {
            border-color: #1e87f0;
        }

        .uk-slideshow-items {
            border: 1px solid #e5e5e5;
            border-radius: 4px;
        }

        .uk-slideshow-items img {
            padding: 20px;
            object-fit: contain !important;
        }
    </style>
</head>

<body>
    <!-- Header section will be same as index.html -->

    <div class="uk-offcanvas-content">
        <main>
            <section class="uk-section uk-section-small">
                <div class="uk-container">
                    <div class="uk-grid-medium uk-child-width-1-1" uk-grid>
                        <!-- Breadcrumb -->
                        <div class="uk-text-center">
                            <ul class="uk-breadcrumb uk-flex-center uk-margin-remove">
                                <li><a href="index.html">Home</a></li>
                                <li><a href="#" id="categoryLink"></a></li>
                                <li><a href="" id="subcategoryLink"></a></li>
                                <li><span id="productTitle"></span></li>
                            </ul>
                            <h1 class="uk-margin-small-top uk-text-large uk-margin-remove-bottom" id="productName"></h1>
                        </div>

                        <!-- Product Content -->
                        <div>
                            <div class="uk-card uk-card-default">
                                <div class="uk-grid-collapse uk-grid-match" uk-grid>
                                    <!-- Image Gallery -->
                                    <div class="uk-width-1-1 uk-width-expand@m">
                                        <div class="uk-card-body">
                                    
                                            <!-- Main Image Slideshow -->
                                            <div uk-slideshow="animation: fade; ratio: 4:3">
                                                <ul class="uk-slideshow-items" id="productImages">
                                                    <!-- Main images will be inserted here -->
                                                </ul>
                                            </div>
                                    
                                            <!-- Thumbnail Navigation -->
                                            <div class="uk-margin-top">
                                                <div uk-slider="sets: true">
                                                    <div class="uk-position-relative">
                                                        <div class="uk-slider-container">
                                                            <ul class="uk-slider-items uk-child-width-1-4 uk-grid uk-grid-small"
                                                                id="productThumbnails">
                                                                <!-- Thumbnails will be inserted here -->
                                                            </ul>
                                                        </div>
                                                        <a class="uk-position-center-left uk-position-small uk-hidden-hover"
                                                            href="#" uk-slidenav-previous uk-slider-item="previous"></a>
                                                        <a class="uk-position-center-right uk-position-small uk-hidden-hover"
                                                            href="#" uk-slidenav-next uk-slider-item="next"></a>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                        </div>
                                    </div>                                    

                                    <!-- Product Info -->
                                    <div class="uk-width-1-1 uk-width-1-3@m">
                                        <div class="uk-card-body">
                                            <!-- Labels -->
                                            <div class="uk-margin">
                                                <div id="productLabels"></div>
                                            </div>

                                            <!-- Quick Specs -->
                                            <div class="uk-margin">
                                                <ul class="uk-list uk-text-small" id="quickSpecs"></ul>
                                            </div>

                                            <!-- Price Box -->
                                            <div class="uk-margin">
                                                <h1 id="productTitleDisplay" class="uk-heading-bullet uk-text-large uk-margin-remove-bottom"></h1>
                                                <div class="uk-padding-small uk-background-muted uk-border-rounded">
                                                    
                                                    <div class="uk-grid-small" uk-grid>
                                                        <div class="uk-width-expand">
                                                            <del class="uk-text-meta" id="oldPrice"></del>
                                                            <div class="tm-product-price" id="currentPrice"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Variations -->
                                            <div class="uk-margin">
                                                <!-- Size Options -->
                                                <div id="sizeOptions">
                                                    <label for="sizeSelect" class="uk-text-small uk-margin-small-bottom">Size</label>
                                                    <select id="sizeSelect" class="uk-select uk-margin-small">
                                                        <option value="">Choose an option</option>
                                                    </select>
                                                </div>

                                                <!-- Color Options -->
                                                <div id="colorOptions" class="uk-margin-top">
                                                    <label for="colorSelect" class="uk-text-small uk-margin-small-bottom">Color</label>
                                                    <select id="colorSelect" class="uk-select uk-margin-small">
                                                        <option value="">Choose an option</option>
                                                    </select>
                                                </div>

                                                <!-- Material Options -->
                                                <div id="materialOptions" class="uk-margin-top">
                                                    <label for="materialSelect" class="uk-text-small uk-margin-small-bottom">Material</label>
                                                    <select id="materialSelect" class="uk-select uk-margin-small">
                                                        <option value="">Choose an option</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Actions -->
                                            <div class="uk-margin">
                                                <button
                                                    class="uk-button uk-button-primary uk-width-1-1 uk-margin-small-bottom">
                                                    <span uk-icon="cart"></span> Add to Cart
                                                </button>
                                                <button class="uk-button uk-button-default uk-width-1-1">
                                                    <span uk-icon="heart"></span> Add to Wishlist
                                                </button>
                                            </div>
                                            <div class="uk-margin">
                                                <div
                                                    class="uk-padding-small uk-background-muted uk-border-rounded">
                                                    <div class="uk-grid-small uk-child-width-1-1 uk-text-small"
                                                        uk-grid>
                                                        <div>
                                                            <div class="uk-grid-collapse" uk-grid><span
                                                                    class="uk-margin-xsmall-right"
                                                                    uk-icon="cart"></span>
                                                                <div>
                                                                    <div class="uk-text-bolder">Delivery</div>
                                                                    <div class="uk-text-xsmall uk-text-muted">In
                                                                        stock, free</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="uk-grid-collapse" uk-grid><span
                                                                    class="uk-margin-xsmall-right"
                                                                    uk-icon="location"></span>
                                                                <div>
                                                                    <div class="uk-text-bolder">Pick up from
                                                                        store</div>
                                                                    <div class="uk-text-xsmall uk-text-muted">In
                                                                        stock, free, tomorrow</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Details Tabs -->
                        <div class="uk-margin-medium-top">
                            <ul class="uk-tab" uk-tab="connect: #product-details">
                                <li><a href="#">Description</a></li>
                                <li><a href="#">Specifications</a></li>
                                <li><a href="#">Reviews</a></li>
                            </ul>

                            <ul id="product-details" class="uk-switcher uk-margin">
                                <li>
                                    <div class="uk-card uk-card-default uk-card-body" id="productDescription"></div>
                                </li>
                                <li>
                                    <div class="uk-card uk-card-default uk-card-body">
                                        <table class="uk-table uk-table-divider uk-table-justify">
                                            <tbody id="specifications"></tbody>
                                        </table>
                                    </div>
                                </li>
                                <li>
                                    <div class="uk-card uk-card-default uk-card-body" id="reviews"></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>


    <!-- Footer section will be same as index.html -->


    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Get product ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');

                console.log("Product ID:", productId); // Debug log

                // Fetch products data
                const response = await fetch('product-admin/products.json');
                if (!response.ok) throw new Error('Failed to load product data');

                const products = await response.json();
                console.log("Products loaded:", products); // Debug log

                // Find product by ID (convert ID to match types)
                const product = products.find(p => p.id.toString() === productId);
                console.log("Found product:", product); // Debug log

                if (!product) {
                    throw new Error('Product not found');
                }

                // Update page content
                document.title = `${product.title} - Selection Furniture`; //Dynamic title change
                document.getElementById('productName').textContent = product.title;
                document.getElementById('categoryLink').textContent = product.category;
                document.getElementById('subcategoryLink').textContent = product.subcategory;
                document.getElementById('productTitle').textContent = product.title;
                document.getElementById('productTitleDisplay').textContent = product.title;
                

                // Load product images
                const imagesContainer = document.getElementById('productImages');
                const thumbnailsContainer = document.getElementById('productThumbnails');

                imagesContainer.innerHTML = '';
                thumbnailsContainer.innerHTML = '';

                product.images.forEach((img, index) => {
                    imagesContainer.innerHTML += `
                        <li>
                            <div class="uk-position-cover">
                                <img src="${img}" 
                                     alt="${product.title} - Image ${index + 1}"
                                     uk-cover>
                            </div>
                        </li>
                    `;
                    thumbnailsContainer.innerHTML += `
                        <li>
                            <a href="#" uk-slideshow-item="${index}">
                                <img src="${img}" 
                                     alt=""
                                     style="height: 80px; width: 100%; object-fit: cover;"
                                     class="uk-border-rounded">
                            </a>
                        </li>
                    `;
                });

                // Click handlers for thumbnails
                document.querySelectorAll('#productThumbnails a').forEach(thumb => {
                    thumb.addEventListener('click', (e) => {
                        e.preventDefault();
                        const index = thumb.getAttribute('uk-slideshow-item');
                        UIkit.slideshow(document.querySelector('[uk-slideshow]')).show(index);
                    });
                });

                // Set initial price
                const currentPriceEl = document.getElementById('currentPrice');
                // Set default price to "Price varies with options" if no price is available with range
                if (product.variations?.sizes?.length > 0) {
                    const prices = product.variations.sizes.map(size => parseFloat(size.price)).filter(p => !isNaN(p));
                    const minPrice = Math.min(...prices);
                    const maxPrice = Math.max(...prices);

                    if (minPrice === maxPrice) {
                        currentPriceEl.textContent = `£${minPrice}`;
                    } else {
                        currentPriceEl.textContent = `£${minPrice} - £${maxPrice}`;
                    }
                } else if (product.price) {
                    currentPriceEl.textContent = `£${product.price}`;
                } else {
                    currentPriceEl.textContent = 'Price varies with options';
                }

                if (product.oldPrice) {
                    document.getElementById('oldPrice').textContent = `£${product.oldPrice}`;
                }

                // Update specifications
                const specs = document.getElementById('specifications');
                specs.innerHTML = '';
                if (product.specifications) {
                    Object.entries(product.specifications).forEach(([key, value]) => {
                        if (value) {
                            specs.innerHTML += `
                                <tr>
                                    <th class="uk-width-medium">${key}</th>
                                    <td>${value}</td>
                                </tr>
                            `;
                        }
                    });
                }

                // Update description
                const descriptionEl = document.getElementById('productDescription');
                descriptionEl.innerHTML = product.description || 'No description available';

                // Populate reviews (if any)
                const reviewsContainer = document.getElementById('reviews');
                if (product.reviews && product.reviews.length > 0) {
                    reviewsContainer.innerHTML = product.reviews.map(r => `
                        <div class="uk-margin-small">
                            <strong>${r.user}</strong> - Rating: ${r.rating}<br>
                            <em>${r.comment}</em>
                        </div>
                    `).join('');
                } else {
                    reviewsContainer.innerHTML = '<p>No reviews available.</p>';
                }

                // Handle variations as dropdowns
                if (product.variations) {
                    // Size variations
                    const sizeOptionsDiv = document.getElementById('sizeOptions');
                    const sizeSelect = document.getElementById('sizeSelect');

                    if (product.variations.sizes && product.variations.sizes.length > 0) {
                        // Clear any default <option> lines (we left one "Choose an option")
                        sizeSelect.innerHTML = '<option value="">Choose an option</option>';
                        product.variations.sizes.forEach(size => {
                            sizeSelect.innerHTML += `
                                <option value="${size.name}" data-price="${size.price}">
                                    ${size.name}${size.dimensions ? ` (${size.dimensions})` : ''}
                                </option>
                            `;
                        });

                        // When user picks a size, update price
                        sizeSelect.addEventListener('change', function () {
                            const selectedOption = this.options[this.selectedIndex];
                            const newPrice = selectedOption.getAttribute('data-price');

                            if (newPrice) {
                                currentPriceEl.textContent = `£${newPrice}`;
                            } else {
                                // fallback to main product price
                                currentPriceEl.textContent = product.price
                                    ? `£${product.price}`
                                    : 'Price varies with options';
                            }
                        });
                    } else {
                        sizeOptionsDiv.style.display = 'none';
                    }

                    // Color variations
                    const colorOptionsDiv = document.getElementById('colorOptions');
                    const colorSelect = document.getElementById('colorSelect');

                    if (product.variations.colors && product.variations.colors.length > 0) {
                        colorSelect.innerHTML = '<option value="">Choose an option</option>';
                        product.variations.colors.forEach(color => {
                            // color.code is optional - depends on your JSON
                            colorSelect.innerHTML += `
                                <option value="${color.name}" data-code="${color.code || ''}">
                                    ${color.name}
                                </option>
                            `;
                        });

                        // If you need an event when color changes, you can add it here
                        colorSelect.addEventListener('change', function () {
                            // e.g. do something with color code
                            // const selectedOption = this.options[this.selectedIndex];
                            // console.log('Selected color code:', selectedOption.getAttribute('data-code'));
                        });
                    } else {
                        colorOptionsDiv.style.display = 'none';
                    }

                    // Material variations
                    const materialOptionsDiv = document.getElementById('materialOptions');
                    const materialSelect = document.getElementById('materialSelect');

                    if (product.variations.materials && product.variations.materials.length > 0) {
                        materialSelect.innerHTML = '<option value="">Choose an option</option>';
                        product.variations.materials.forEach(material => {
                            materialSelect.innerHTML += `
                                <option value="${material.name}">
                                    ${material.name}
                                </option>
                            `;
                        });

                        // If you need an event when material changes, you can add it here
                        materialSelect.addEventListener('change', function () {
                            // e.g. do something with material
                            // const selectedOption = this.options[this.selectedIndex];
                            // console.log('Selected material:', selectedOption.value);
                        });
                    } else {
                        materialOptionsDiv.style.display = 'none';
                    }
                }

            } catch (error) {
                console.error('Error loading product:', error);
                document.querySelector('main').innerHTML = `
                    <div class="uk-container uk-margin-large-top uk-margin-large-bottom uk-text-center">
                        <h1>Product Not Found</h1>
                        <p>Sorry, we couldn't find the product you're looking for.</p>
                        <a href="index.html" class="uk-button uk-button-primary">
                            Return to Homepage
                        </a>
                    </div>
                `;
            }
        });
    </script>
</body>

</html>